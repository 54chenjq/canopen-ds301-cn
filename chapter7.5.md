##7.5 **通信协议规范**
###7.5.1 **对象及其条目说明规范**
对象字典对象的条目结构描述遵守以下方式：所有设备协议、接口协议和应用协议都基于通信协议所使用的对象及其条目说明规则，见表52和表53。
<center/>表52：对象描述格式

**对象描述**

|索引|协议定义的索引号|
|---|---|
|名称|参数名称|
|对象代码|变量的分类|
|数据类型|数据类型分类|
|类别|可选的或强制性的区分|
对象代码是表52描述的对象定义的成员。考虑可读性，对象描述要附带对象的名称。

<center/>表53：对象值的描述格式

**条目说明**

|子索引|子项编号|
|---|---|
|描述|描述子索引名称(字段只用于数组、记录和结构)|
|数据类型|数据类型分类(字段只用于记录和结构)|
|条目类别|表明对象条目是可选、强制还是条件的|
|访问权限|只读(ro)或读/写(rw)或只写(wo)|
|PDO映射|如果该对象可映射至PDO则定义该项。说明：<br/>可选：对象可以映射到PDO<br/>默认值：对象是默认映射的一部分(请参见设备协议或应用协议)<br/>TPDO：对象可被映射到TPDO不应被映射到RPDO<br/>RPDO：对象可被映射到RPDO不应该映射到TPDO<br/>无：对象不应映射到PDO|
|取值范围|可能的取值范围，或数据类型的全部取值范围|
|默认值|无：无默认值<br/>协议指定：由协议指定默认值<br/>造商指定：默认值由CANopen设备制造商指定<br/>值：CANopen设备初始化后的默认值|
简单的变量带有值定义即可，无须格外的条目类别定义。复合数据类型其值定义应包括每个元素(子索引)。
###7.5.2 **通信协议对象的详细规范**
####7.5.2.1 **对象1000h：设备类型**
此对象提供有关设备类型的信息。该对象描述了逻辑设备类型及其功能。它由两个16位域组成，一个描述所用设备协议或应用协议，另一个给出逻辑设备的附加功能信息。附加的信息参数为设备协议和应用协议所指定。其说明不属于本文范围，定义于相应的设备协议和应用协议。  
**值定义**  
该值为0000h表示逻辑设备不遵守标准设备协议。在这种情况下附加的信息应为0000h(如果没有更多的逻辑设备)或FFFF<sub>h</sub>(如果还有其它逻辑设备)。  
多逻辑设备其附加信息应为FFFF<sub>h</sub>且其设备协议应为对象字典中第一逻辑设备。所有其他逻辑设备模块的协议标识于对象67FF<sub>h</sub> + x \* 800<sub>h</sub>且x = 逻辑设备内部编号(从1到8)减去1。这些对象将描述逻辑设备的设备类型，与对象1000<sub>h</sub>具有相同的值定义。  
![图52：设备类型参数结构](./CANopen_DS301_CN_image/52.png)
图52：设备类型参数结构  
**对象描述**

|索引|1000<sub>h</sub>|
|---|---|
|名称|设备类型|
|对象代码|VAR|
|数据类型|UNSIGNED32|
|类别|强制|

**条目说明**  

|子索引|00<sub>h</sub>|
|---|---|
|访问权限|ro|
|PDO 映射|否|
|取值范围|请参阅*值定义*|
|默认值|协议或制造商指定|
####7.5.2.2 **对象1001h：错误寄存器**
此对象提供错误信息记录，CANopen设备将内部错误记录映射到该对象，此为应急对象的一部分。  
**值定义**
<center/>表54：错误寄存器结构

|位|M/O|意义|
|---|---|---|
|0|M|通用错误|
|1|O|电流|
|2|O|电压|
|3|O|温度|
|4|O|通信错误(溢出、错误状态)|
|5|O|设备协议指定|
|6|O|保留(始终为0<sub>b</sub>)|
|7|O|制造商指定|
如果某一特定的错误发生相应位置1b。通用错误位是强制设备必须支持的，其它可选。任何错误产生都将置位通用错误。  
**对象描述**

|索引|1001<sub>h</sub>|
|---|---|
|名称|错误寄存器|
|对象代码|VAR|
|数据类型|UNSIGNED8|
|类别|强制|
 
**条目说明**

|子索引|00<sub>h</sub>|
|---|---|
|访问权限|ro|
|PDO 映射|可选|
|取值范围|请参阅值定义|
|默认值|无|
####7.5.2.3 **对象 1002h：制造商状态寄存器**
此对象为制造商提供一个常规状态寄存器。 本规范仅定义此对象大小和位置。  
**对象描述**

|索引|1002<sub>h</sub>|
|---|---|
|名称|制造商状态寄存器|
|对象代码|VAR|
|数据类型|UNSIGNED32|
|类别|可选|
**条目说明**

|子索引|00<sub>h</sub>|
|---|---|
|访问权限|ro|
|PDO 映射|可选|
|取值范围|UNSIGNED32|
|默认值|无|
####7.5.2.4 **对象1003h：预定义错误域**
此对象表达CANopen设备上产生的错误，由应急对象编入，并提供错误历史纪录。  
**值定义**  
* 该对象子索引00<sub>h</sub>为从01<sub>h</sub>开始的实际的错误记录数量。
        备注：如果无错误存在其子索引00<sub>h</sub>值为00<sub>h</sub>，读子索引01<sub>h</sub>将得到SDO中止消息(中止代码： 0800 0024<sub>h</sub>或0800 0000<sub>h</sub>)。
* 每个新的错误应储存在子索引01<sub>h</sub>，较旧的错误应依次下移。
* 写00<sub>h</sub>到子索引00h将删除整个错误历史记录(清空数组)。禁止写入非00<sub>h</sub>值，否则将得到中止信息(错误代码:0609 0030<sub>h</sub>)。
* 错误代码的类型为UNSIGNED32(见表26)，由16位错误代码和16位制造商指定的附加错误信息组成。错误代码位于低2字节(LSB)，附加信息位于高2字节(MSB)。支持此对象应至少包含两个条目，长度子索引00h和至少一个错误项01<sub>h</sub>。
![图53：预定义错误域结构](./CANopen_DS301_CN_image/53.png)
图53：预定义错误域结构
 
**对象描述**

|索引1003<sub>h</sub>|
|---|---|
|名称|预定义错误域|
|对象代码|数组|
|数据类型|UNSIGNED32|
|类别|可选|
**条目说明**

|子索引|00<sub>h</sub>|
|---|---|
|描述|错误数|
|条目类别|强制|
|访问权限|rw|
|PDO 映射|否|
|取值范围|00<sub>h</sub>到FE<sub>h<sub>|
|默认值|00<sub>h</sub>|

|子索引|01<sub>h</sub>|
|---|---|
|描述|标准错误域|
|条目类别|强制|
|访问权限|ro|
|PDO 映射|否|
|取值范围|UNSIGNED32|
|默认值|无|

|子索引|02<sub>h</sub>到FE<sub>h</sub>|
|---|---|
|描述|标准错误域|
|条目类别|可选|
|访问权限|ro|
|PDO 映射|否|
|取值范围|UNSIGNED32|
|默认值|无|

####7.5.2.5 **对象1005h：COB-ID同步消息**
此对象为已配置的同步(SYNC)对象COB-ID。此外，它定义了 CANopen 设备是否生成同步。对象结构定义于图54和表55。
值定义  
![图54：同步COB-ID结构](./CANopen_DS301_CN_image/54.png)
图54：同步COB-ID结构

<center/>表55：同步COB-ID描述  

|**位(S)**|**值**|**描述**|
|---|---|---|
|x|x|无意义|
|gen.|0<sub>b</sub><br/>1<sub>b<sub>|所在CANopen设备不生成同步消息<br/>CANopen设备生成同步消息|
|frame|0<sub>b</sub><br/>1<sub>b</sub>|11位CAN-ID有效(CAN标准帧)<br/>29位CAN-ID有效(CAN扩展帧)|
|29位CAN-ID|x|29位扩展帧CAN-ID|
|11位CAN-ID|x|11位标准帧CAN-ID|
位29(frame)和位30(gen.)可以是静态的(不可更改)。如果CANopen设备不生成同步消息，试图设置30位(gen.)为1<sub>b</sub>将得到SDO中止应答(中止代码：0609 0030<sub>h</sub>)。如果CANopen设备仅支持标准帧，则试图置位29(frame)为1<sub>b</sub>将得到SDO中止应答(中止代码：0609 0030<sub>h<sub>)。设置位30至1<sub>b</sub>并且同步计数器的溢出值大于0，在计数器值复位为1时启动第一次SYNC消息。对象有效时(位 30 = 1<sub>b<sub/>)不允许更改0~29位。  
**对象描述**

索引	1005h
名称	同步COB-ID 
对象代码	VAR
数据类型	UNSIGNED32
类别	条件的
强制的，如果PDO通信支持基于同步方式
条目说明

子索引	00h
访问权限	rw
const如果COB-ID不可更改
PDO 映射	否
取值范围	请参阅值定义
默认值	0000 0080h或8000 0080h

